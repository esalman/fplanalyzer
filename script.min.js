var fplAnalyzer={initialized:false,teamArr:{Fulham:"FUL",Arsenal:"ARS",Everton:"EVE","West Brom":"WBA","Hull City":"HUL",Norwich:"NOR",Newcastle:"NEW","West Ham":"WHM",Southampton:"SOU",Sunderland:"SUN","Stoke City":"STK","Crystal Palace":"CPA","Aston Villa":"AVL",Liverpool:"LIV","Cardiff City":"CAR","Man City":"MCY",Tottenham:"TOT",Swansea:"SWA","Man Utd":"MUN",Chelsea:"CHE"},fixArr:{},playerAttrib:{},currentGW:0,options:{domain:"http://pure-ocean-7640.herokuapp.com/",numberOfOpponentsToDisplay:1},controls:{loader:$('<span style="background: #F00; color: #FFF; position: fixed; top: 0px; left: 0px; padding: 3px 3px; display: none;">Loading...</span>'),pitchControls:{reload:$('<a class="reload" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">Reload</a>'),prevGW:$('<a class="prevGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">GW-1</a>'),nextGW:$('<a class="nextGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">GW+1</a>'),opponent:$('<a class="opponent" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">Opponent</a>'),price:$('<a class="price" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">Price</a>'),ntit:$('<a class="ntit" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">NTI day</a>'),nti:$('<a class="nti" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">NTI%</a>'),genRMT:$('<a class="genRMT" style="background: #126e37; color: #FFF; padding: 2px 3px; display: block; margin-bottom: 1px; font-size: smaller;" href="javascript:void(0)">Gen RMT</a>')}},init:function(){fplAnalyzer.initialized=true;$("body").append(fplAnalyzer.controls.loader);var e=$('<div id="fplAnalyzerControl" style="position: absolute; top: 0px; left: 0px; font-size: smaller;"></div>');$.each(fplAnalyzer.controls.pitchControls,function(t,n){e.append(n);n.bind("click",fplAnalyzer.events[t])});$("#ism .ismPitch").css("position","relative").append(e);$("#ism .ismFixtureContainer").bind("DOMNodeInserted",function(e){fplAnalyzer.updateFixtureNavigateButton();fplAnalyzer.update()})},update:function(){fplAnalyzer.controls.loader.show();fplAnalyzer.loadFisoData()},loadFixture:function(){fplAnalyzer.fixArr={};if(!$(".ismFixtureTable caption").html())return;fplAnalyzer.currentGW=$(".ismFixtureTable caption").html().split("-")[0].replace("Gameweek","").trim();$.each($(".ismFixtureTable tbody tr"),function(e,t){h=$(t).children(".ismHomeTeam").html();a=$(t).children(".ismAwayTeam").html();if(fplAnalyzer.teamArr[h]==undefined)return;if(fplAnalyzer.fixArr[h]==undefined){fplAnalyzer.fixArr[h]={};fplAnalyzer.fixArr[h][fplAnalyzer.currentGW]=fplAnalyzer.teamArr[a].toUpperCase()}else fplAnalyzer.fixArr[h][fplAnalyzer.currentGW]+=" "+fplAnalyzer.teamArr[a].toUpperCase();if(fplAnalyzer.fixArr[a]==undefined){fplAnalyzer.fixArr[a]={};fplAnalyzer.fixArr[a][fplAnalyzer.currentGW]=fplAnalyzer.teamArr[h].toLowerCase()}else fplAnalyzer.fixArr[a][fplAnalyzer.currentGW]+=" "+fplAnalyzer.teamArr[h].toLowerCase()})},updateOpponent:function(){$.each($("#ismTeamDisplayGraphical div[id^=ismGraphical]"),function(e,t){$(t).find(".ismElementDetail dd").css("background-color","#126E37");var n='<div class="opponent">'+fplAnalyzer.getNextNOpponent($(t).find(".ismShirt").attr("title"))+"</div>";var r='<div class="nti" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIPercent+"%</div>";var i='<div class="ntit" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIToday+"</div>";var s='<div class="price" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].price+"</div>";$(t).find(".ismElementDetail dd").html(n+s+r+i)});fplAnalyzer.controls.loader.hide()},loadFisoData:function(){var e=[];$.each($("div[id^=ismGraphical]"),function(t,n){var r=fplAnalyzer.getPlayerIDFromContainer(n);if(fplAnalyzer.playerAttrib[r]==undefined){fplAnalyzer.playerAttrib[r]={};e.push(r)}});if(e.length<1){fplAnalyzer.loadFixture();fplAnalyzer.updateOpponent();return}$.getJSON(fplAnalyzer.options.domain+"fisoparse.php",{id:e.join(",")}).done(function(e){$.each(e,function(e,t){fplAnalyzer.playerAttrib[e].NTIPercent=t.c;fplAnalyzer.playerAttrib[e].price=t.p;fplAnalyzer.playerAttrib[e].NTIToday=t.d});fplAnalyzer.loadFixture();fplAnalyzer.updateOpponent()})},getPlayerIDFromContainer:function(e){return $(e).find("a.ismViewProfile").attr("href").replace("#","")},getPlayerPriceFromContainer:function(e){return $(e).find("dd > span").html()},events:{reload:function(){fplAnalyzer.update()},prevGW:function(){fplAnalyzer.controls.loader.show();$(".ismPagination a").first().click()},nextGW:function(){fplAnalyzer.controls.loader.show();$(".ismPagination a").last().click()},opponent:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.opponent").css("display","block")},price:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.price").css("display","block")},nti:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.nti").css("display","block")},ntit:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.ntit").css("display","block")},genRMT:function(){var e="";$.each($(".ismPitchRow"),function(t,n){e+="\n";if(t==4)e+="\nSubs: ";$.each($(n).find("div[id^=ismGraphical]"),function(t,n){e+=$(n).find("span.ismPitchWebName").html().trim()+" "})});window.prompt("You can copy the following RMT string:",e)}},updateFixtureNavigateButton:function(){if($(".ismPagPrev").length>0)$("#fplAnalyzerControl .prevGW").html($(".ismPagPrev").html().replace("Gameweek","GW"));if($(".ismPagNext").length>0)$("#fplAnalyzerControl .nextGW").html($(".ismPagNext").html().replace("Gameweek","GW"))},getNextNOpponent:function(e){var t="";for(i=0;i<fplAnalyzer.options.numberOfOpponentsToDisplay;i++){if(fplAnalyzer.fixArr[e]==undefined||fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]==undefined)continue;t+=fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]+(i<fplAnalyzer.options.numberOfOpponentsToDisplay-1?" ":"")}return t}};var fplAnalyzeTrigger=function(){if(location.href.search("fantasy.premierleague.com")<0)return;if(!fplAnalyzer.initialized)fplAnalyzer.init();fplAnalyzer.update()}