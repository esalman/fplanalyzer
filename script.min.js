var fplAnalyzer={initialized:!1,teamArr:{Leicester:"LEI",Arsenal:"ARS",Everton:"EVE","West Brom":"WBA",Hull:"HUL",QPR:"QPR",Newcastle:"NEW","West Ham":"WHM",Southampton:"SOU",Sunderland:"SUN",Stoke:"STK","Crystal Palace":"CPA","Aston Villa":"AVL",Liverpool:"LIV",Burnley:"BUR","Man City":"MCY",Spurs:"TOT",Swansea:"SWA","Man Utd":"MUN",Chelsea:"CHE"},fixArr:{},playerAttrib:{},currentGW:0,totalPlayer:null,options:{domain:"http://pure-ocean-7640.herokuapp.com/",numberOfOpponentsToDisplay:1,predictors:{CTC:"FISO CrackTheCode (http://www.fiso.co.uk/crackthecode.php)",TFPL:"TotalFPL (http://totalfpl.com/pricechanges)"},selectedPredictor:"CTC",teamId:null},controls:{loader:$('<span style="background: #F00; color: #FFF; position: fixed; top: 0px; left: 0px; padding: 3px 3px; display: none;">Loading...</span>'),pitchControls:{reload:$('<a class="reload" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Reload">&#8634;</a>'),prevGW:$('<a class="prevGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Previous GW">◀</a>'),nextGW:$('<a class="nextGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Next GW">▶</a>'),oppoNos:$('<a class="oppoNos" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center; font-style: italic;" href="javascript:void(0)" title="Number of GW">1</a><br />'),points:$('<a class="points" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Points (Live BPS)">P</a>'),opponent:$('<a class="opponent" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Opponent">V</a>'),price:$('<a class="price" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Price">£</a>'),own:$('<a class="own" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="% Ownership">%</a><br />'),ntit:$('<a class="ntit" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="NTI Today">T</a>'),nti:$('<a class="nti" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="% NTI">%</a>'),predictor:$('<a class="predictor" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Change Predictor">&#x25EA;</a><br />'),genRMT:$('<a class="genRMT" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Rate My Team!">★</a>'),webLink:$('<a class="webLink" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="http://fplanalyzer.com" target="_blank" title="www.fplanalyzer.com">?</a>'),share:$('<a class="share" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Share FPL Analyzer!">❤</a><div class="addthis_sharing_toolbox" style="display: none;" data-url="http://fplanalyzer.com" data-title="Check out FPL Analyzer!"></div>')}},init:function(){fplAnalyzer.initialized=!0,$("body").append(fplAnalyzer.controls.loader),$(".ismElementDetail").css("text-shadow","1px 1px 1px #000");var e=$(".ismDefList.ismRHSDefList").length>0?0:-42,t=$('<div id="fplAnalyzerControl" style="position: absolute; top: '+e+'px; left: 0px; font-size: smaller;"></div>');$.each(fplAnalyzer.controls.pitchControls,function(e,i){t.append(i),i.bind("click",fplAnalyzer.events[e])}),$("#ism .ismPitch").css("position","relative").append(t),$("#ism .ismFixtureContainer").bind("DOMNodeInserted",function(){fplAnalyzer.updateFixtureNavigateButton(),fplAnalyzer.update()}),fplAnalyzer.options.teamId=$("nav li:nth-child(2) a").attr("href").split("/")[2],$(".ismDefList.ismRHSDefList").length>0&&(fplAnalyzer.totalPlayer=parseInt($($(".ismDefList.ismRHSDefList").children("dd")[2]).text().replace(/,/g,"")),createCookie("fplAnalyzerTotalPlayer",fplAnalyzer.totalPlayer,30)),readCookie("fplAnalyzerTotalPlayer")&&fplAnalyzer.totalPlayer!=readCookie("fplAnalyzerTotalPlayer")&&(fplAnalyzer.totalPlayer=readCookie("fplAnalyzerTotalPlayer"));var i=readCookie("fplAnalyzerSelectedPredictor");i&&(fplAnalyzer.options.selectedPredictor=i),$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor");var n=readCookie("fplAnalyzerNumberOfOpponentsToDisplay");fplAnalyzer.options.numberOfOpponentsToDisplay=n?n:1,$("a.oppoNos").html(fplAnalyzer.options.numberOfOpponentsToDisplay);var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src","//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53edcfcd20914b86"),document.getElementsByTagName("head")[0].appendChild(a)},update:function(e){fplAnalyzer.controls.loader.show(),fplAnalyzer.loadNTIData(e)},loadFixture:function(){$(".ismFixtureTable caption").html()&&(fplAnalyzer.currentGW=$(".ismFixtureTable caption").html().split("-")[0].replace("Gameweek","").trim(),$.each(fplAnalyzer.teamArr,function(e){void 0==fplAnalyzer.fixArr[e]&&(fplAnalyzer.fixArr[e]={}),fplAnalyzer.fixArr[e][fplAnalyzer.currentGW]=""}),$.each($(".ismFixtureTable tbody tr"),function(e,t){h=$(t).children(".ismHomeTeam").html(),a=$(t).children(".ismAwayTeam").html(),void 0!=fplAnalyzer.teamArr[h]&&(fplAnalyzer.fixArr[h][fplAnalyzer.currentGW]+=fplAnalyzer.teamArr[a].toUpperCase()+" ",fplAnalyzer.fixArr[a][fplAnalyzer.currentGW]+=fplAnalyzer.teamArr[h].toLowerCase()+" ")}))},updateOpponent:function(){$.each($("#ismTeamDisplayGraphical div[id^=ismGraphical]"),function(e,t){var i='<div class="opponent">'+fplAnalyzer.getNextNOpponent($(t).find(".ismShirt").attr("title"))+"</div>",n='<div class="nti" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIPercent+"%</div>",a='<div class="ntit" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIToday+"</div>",l='<div class="price" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].price+"</div>",r='<div class="ownership" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].ownership+"</div>",o=fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].bonus,p=fplAnalyzer.getPlayerDataFromContainer(t,"event_points")+(void 0!=o&&o>0?o:0);1==fplAnalyzer.getPlayerDataFromContainer(t,"is_captain")&&(p*=2);var s='<div class="points" style="display: none; '+(void 0!=o&&o>0?"color: #0F0; ":"")+'">'+p+"</div>";$(t).find(".ismElementDetail dd").html(i+l+n+a+r+s)}),fplAnalyzer.controls.loader.hide()},loadNTIData:function(e){var t=[];return $.each($("div[id^=ismGraphical]"),function(i,n){var a=fplAnalyzer.getPlayerIDFromContainer(n);(e===!0||void 0==fplAnalyzer.playerAttrib[a])&&(fplAnalyzer.playerAttrib[a]={name:fplAnalyzer.getPlayerNameFromContainer(n)},t.push(a))}),t.length<1?(fplAnalyzer.loadFixture(),void fplAnalyzer.updateOpponent()):($.getJSON(fplAnalyzer.options.domain+"parse.php",{id:t.join(","),p:fplAnalyzer.options.selectedPredictor,cid:fplAnalyzer.options.teamId}).done(function(e){$.each(e,function(e,t){fplAnalyzer.playerAttrib[e].NTIPercent=t.c,fplAnalyzer.playerAttrib[e].price=t.p,fplAnalyzer.playerAttrib[e].NTIToday=t.d,fplAnalyzer.playerAttrib[e].ownership=fplAnalyzer.totalPlayer?(100*t.n.replace(/[^\d\.\-\ ]/g,"")/fplAnalyzer.totalPlayer).toFixed(2)+"%":t.n}),fplAnalyzer.updateOpponent()}),fplAnalyzer.loadFixture(),void fplAnalyzer.updateOpponent())},getPlayerIDFromContainer:function(e){return $(e).find("a.ismViewProfile").attr("href").replace("#","")},getPlayerNameFromContainer:function(e){return $(e).find(".ismPitchWebName").html().trim()},getPlayerDataFromContainer:function(e,t){return"{"!=$(e).attr("class").split("  ")[1][0]?"":JSON.parse($(e).attr("class").split("  ")[1])[t]},events:{reload:function(){fplAnalyzer.update(!0)},prevGW:function(){fplAnalyzer.controls.loader.show(),$(".ismPagination a").first().click()},nextGW:function(){fplAnalyzer.controls.loader.show(),$(".ismPagination a").last().click()},points:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.points").css("display","block");var e=(parseInt($(".ismSBValue.ismSBPrimary div").html().split("<")[0].trim()),[]);$.each($("div[id^=ismGraphical]"),function(t,i){var n=$('#ismFixtureTable td:contains("'+$(i).find("img.ismShirt").attr("title")+'")').parent().next().find("a.ismFixtureStatsLink").attr("data-id");void 0!=n&&-1==e.indexOf(n)&&e.push(n)});for(var t=0;t<e.length;t++)fplAnalyzer.controls.loader.show(),$.get("http://fantasy.premierleague.com/fixture/"+e[t],function(e){var t=[],i=0;if($.each($($(e)[2]).find("tr"),function(e,n){$(n).find("td")[0]&&(i+=parseInt($($(n).find("td")[12]).html().trim()),t.push({name:$($(n).find("td")[0]).html().trim(),bps:parseInt($($(n).find("td")[14]).html().trim()),tp:parseInt($($(n).find("td")[15]).html().trim())}))}),$.each($($(e)[4]).find("tr"),function(e,n){$(n).find("td")[0]&&(i+=parseInt($($(n).find("td")[12]).html().trim()),t.push({name:$($(n).find("td")[0]).html().trim(),bps:parseInt($($(n).find("td")[14]).html().trim()),tp:parseInt($($(n).find("td")[15]).html().trim())}))}),i>0)return void fplAnalyzer.controls.loader.hide();for(var n=0;n<t.length-1;n++)for(var a=n+1;a<t.length;a++)if(t[n].bps<t[a].bps){var l=t[a];t[a]=t[n],t[n]=l}for(var r=3,n=0;n<t.length&&!(n>0&&r>0&&(t[n].bps<t[n-1].bps&&r--,0>=r));n++)$.each($("div[id^=ismGraphical]"),function(e,i){if(fplAnalyzer.getPlayerNameFromContainer(i)==t[n].name){var a=t[n].tp+r;1==fplAnalyzer.getPlayerDataFromContainer(i,"is_captain")&&(a*=2),$(i).find(".ismElementDetail dd div.points").html(a).css("color","#0F0"),fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerDataFromContainer(i,"id")].bonus=r}});var o=0;$.each($("div[id^=ismGraphical]"),function(e,t){0==fplAnalyzer.getPlayerDataFromContainer(t,"sub")&&(o+=parseInt($(t).find(".points").html()))}),$(".ismSBValue.ismSBPrimary div").html(o+"<sub>pts</sub>"),fplAnalyzer.controls.loader.hide()})},opponent:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.opponent").css("display","block")},price:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.price").css("display","block")},nti:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.nti").css("display","block")},ntit:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.ntit").css("display","block")},own:function(){$(".ismElementDetail dd > div").css("display","none"),$(".ismElementDetail dd > div.ownership").css("display","block")},share:function(){"none"===$(".addthis_sharing_toolbox").css("display")?$(".addthis_sharing_toolbox").show():$(".addthis_sharing_toolbox").hide()},genRMT:function(){var e="";$.each($(".ismPitchRow"),function(t,i){e+="\n",4==t&&(e+="\nSubs: "),$.each($(i).find("div[id^=ismGraphical]"),function(t,i){e+=$(i).find("span.ismPitchWebName").html().trim()+" "})}),window.prompt("You can copy the following RMT string:",e)},predictor:function(){"CTC"==fplAnalyzer.options.selectedPredictor?fplAnalyzer.options.predictors.TFPL:fplAnalyzer.options.predictors.CTC;"CTC"==fplAnalyzer.options.selectedPredictor?confirm("You are currently using "+fplAnalyzer.options.predictors.CTC+". Change predictor to "+fplAnalyzer.options.predictors.TFPL+"?")&&(fplAnalyzer.options.selectedPredictor="TFPL",createCookie("fplAnalyzerSelectedPredictor",fplAnalyzer.options.selectedPredictor,30),$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor")):"TFPL"==fplAnalyzer.options.selectedPredictor&&confirm("You are currently using "+fplAnalyzer.options.predictors.TFPL+". Change predictor to "+fplAnalyzer.options.predictors.CTC+"?")&&(fplAnalyzer.options.selectedPredictor="CTC",createCookie("fplAnalyzerSelectedPredictor",fplAnalyzer.options.selectedPredictor,30),$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor"))},oppoNos:function(){fplAnalyzer.options.numberOfOpponentsToDisplay=fplAnalyzer.options.numberOfOpponentsToDisplay%3+1,createCookie("fplAnalyzerNumberOfOpponentsToDisplay",fplAnalyzer.options.numberOfOpponentsToDisplay,30),$("a.oppoNos").html(fplAnalyzer.options.numberOfOpponentsToDisplay)}},updateFixtureNavigateButton:function(){$(".ismPagPrev").length>0&&$("#fplAnalyzerControl .prevGW").html($(".ismPagPrev").html().replace("Gameweek ","")),$(".ismPagNext").length>0&&$("#fplAnalyzerControl .nextGW").html($(".ismPagNext").html().replace("Gameweek ",""))},getNextNOpponent:function(e){var t="";for(i=0;i<fplAnalyzer.options.numberOfOpponentsToDisplay;i++)void 0!=fplAnalyzer.fixArr[e]&&void 0!=fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]&&(t+=fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]+(i<fplAnalyzer.options.numberOfOpponentsToDisplay-1?" ":""));return t}},fplAnalyzeTrigger=function(){location.href.search("fantasy.premierleague.com")<0||(fplAnalyzer.initialized||fplAnalyzer.init(),fplAnalyzer.update())},createCookie=function(e,t,i){if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var a="; expires="+n.toGMTString()}else var a="";document.cookie=e+"="+t+a+"; path=/"},readCookie=function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},eraseCookie=function(e){createCookie(e,"",-1)};