var fplAnalyzer={initialized:false,teamArr:{Leicester:"LEI",Arsenal:"ARS",Everton:"EVE","West Brom":"WBA",Hull:"HUL",QPR:"QPR",Newcastle:"NEW","West Ham":"WHM",Southampton:"SOU",Sunderland:"SUN",Stoke:"STK","Crystal Palace":"CPA","Aston Villa":"AVL",Liverpool:"LIV",Burnley:"BUR","Man City":"MCY",Spurs:"TOT",Swansea:"SWA","Man Utd":"MUN",Chelsea:"CHE"},fixArr:{},playerAttrib:{},currentGW:0,totalPlayer:null,options:{domain:"http://pure-ocean-7640.herokuapp.com/",numberOfOpponentsToDisplay:1,predictors:{CTC:"FISO CrackTheCode (http://www.fiso.co.uk/crackthecode.php)",TFPL:"TotalFPL (http://totalfpl.com/pricechanges)"},selectedPredictor:"CTC",teamId:null},controls:{loader:$('<span style="background: #F00; color: #FFF; position: fixed; top: 0px; left: 0px; padding: 3px 3px; display: none;">Loading...</span>'),pitchControls:{reload:$('<a class="reload" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Reload">&#8634;</a>'),prevGW:$('<a class="prevGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Previous GW">◀</a>'),nextGW:$('<a class="nextGW" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Next GW">▶</a><br />'),opponent:$('<a class="opponent" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Opponent">V</a>'),price:$('<a class="price" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Price">£</a>'),own:$('<a class="own" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="% Ownership">%</a><br />'),ntit:$('<a class="ntit" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="NTI Today">T</a>'),nti:$('<a class="nti" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="% NTI">%</a>'),predictor:$('<a class="predictor" style="background: #126e37; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Change Predictor">&#x25EA;</a><br />'),genRMT:$('<a class="genRMT" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Rate My Team!">★</a>'),webLink:$('<a class="webLink" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="http://fplanalyzer.com" target="_blank" title="www.fplanalyzer.com">?</a>'),share:$('<a class="share" style="background: #35A649; color: #FFF; padding: 2px 3px; display: inline-block; margin: 0px 1px 1px 0px; font-size: small; width: 14px; text-align: center;" href="javascript:void(0)" title="Share FPL Analyzer!">❤</a><div class="addthis_sharing_toolbox" style="display: none;" data-url="http://fplanalyzer.com" data-title="Check out FPL Analyzer!"></div>')}},init:function(){fplAnalyzer.initialized=true;$("body").append(fplAnalyzer.controls.loader);var e=$(".ismDefList.ismRHSDefList").length>0?0:-42;var t=$('<div id="fplAnalyzerControl" style="position: absolute; top: '+e+'px; left: 0px; font-size: smaller;"></div>');$.each(fplAnalyzer.controls.pitchControls,function(e,n){t.append(n);n.bind("click",fplAnalyzer.events[e])});$("#ism .ismPitch").css("position","relative").append(t);$("#ism .ismFixtureContainer").bind("DOMNodeInserted",function(e){fplAnalyzer.updateFixtureNavigateButton();fplAnalyzer.update()});fplAnalyzer.options.teamId=$("nav li:nth-child(2) a").attr("href").split("/")[2];if($(".ismDefList.ismRHSDefList").length>0){fplAnalyzer.totalPlayer=parseInt($($(".ismDefList.ismRHSDefList").children("dd")[2]).text().replace(/,/g,""));createCookie("fplAnalyzerTotalPlayer",fplAnalyzer.totalPlayer,30)}if(readCookie("fplAnalyzerTotalPlayer")&&fplAnalyzer.totalPlayer!=readCookie("fplAnalyzerTotalPlayer"))fplAnalyzer.totalPlayer=readCookie("fplAnalyzerTotalPlayer");var n=readCookie("fplAnalyzerSelectedPredictor");if(n)fplAnalyzer.options.selectedPredictor=n;$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor");var r=document.createElement("script");r.setAttribute("type","text/javascript");r.setAttribute("src","//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53edcfcd20914b86");document.getElementsByTagName("head")[0].appendChild(r)},update:function(e){fplAnalyzer.controls.loader.show();fplAnalyzer.loadNTIData(e)},loadFixture:function(){fplAnalyzer.fixArr={};if(!$(".ismFixtureTable caption").html())return;fplAnalyzer.currentGW=$(".ismFixtureTable caption").html().split("-")[0].replace("Gameweek","").trim();$.each($(".ismFixtureTable tbody tr"),function(e,t){h=$(t).children(".ismHomeTeam").html();a=$(t).children(".ismAwayTeam").html();if(fplAnalyzer.teamArr[h]==undefined)return;if(fplAnalyzer.fixArr[h]==undefined){fplAnalyzer.fixArr[h]={};fplAnalyzer.fixArr[h][fplAnalyzer.currentGW]=fplAnalyzer.teamArr[a].toUpperCase()}else fplAnalyzer.fixArr[h][fplAnalyzer.currentGW]+=" "+fplAnalyzer.teamArr[a].toUpperCase();if(fplAnalyzer.fixArr[a]==undefined){fplAnalyzer.fixArr[a]={};fplAnalyzer.fixArr[a][fplAnalyzer.currentGW]=fplAnalyzer.teamArr[h].toLowerCase()}else fplAnalyzer.fixArr[a][fplAnalyzer.currentGW]+=" "+fplAnalyzer.teamArr[h].toLowerCase()})},updateOpponent:function(){$.each($("#ismTeamDisplayGraphical div[id^=ismGraphical]"),function(e,t){var n='<div class="opponent">'+fplAnalyzer.getNextNOpponent($(t).find(".ismShirt").attr("title"))+"</div>";var r='<div class="nti" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIPercent+"%</div>";var i='<div class="ntit" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].NTIToday+"</div>";var s='<div class="price" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].price+"</div>";var o='<div class="ownership" style="display: none;">'+fplAnalyzer.playerAttrib[fplAnalyzer.getPlayerIDFromContainer(t)].ownership+"</div>";$(t).find(".ismElementDetail dd").html(n+s+r+i+o)});fplAnalyzer.controls.loader.hide()},loadNTIData:function(e){var t=[];$.each($("div[id^=ismGraphical]"),function(n,r){var i=fplAnalyzer.getPlayerIDFromContainer(r);if(e===true||fplAnalyzer.playerAttrib[i]==undefined){fplAnalyzer.playerAttrib[i]={};t.push(i)}});if(t.length<1){fplAnalyzer.loadFixture();fplAnalyzer.updateOpponent();return}$.getJSON(fplAnalyzer.options.domain+"parse.php",{id:t.join(","),p:fplAnalyzer.options.selectedPredictor,cid:fplAnalyzer.options.teamId}).done(function(e){$.each(e,function(e,t){fplAnalyzer.playerAttrib[e].NTIPercent=t.c;fplAnalyzer.playerAttrib[e].price=t.p;fplAnalyzer.playerAttrib[e].NTIToday=t.d;fplAnalyzer.playerAttrib[e].ownership=fplAnalyzer.totalPlayer?(t.n.replace(/[^\d\.\-\ ]/g,"")*100/fplAnalyzer.totalPlayer).toFixed(2)+"%":t.n});fplAnalyzer.loadFixture();fplAnalyzer.updateOpponent()});fplAnalyzer.loadFixture();fplAnalyzer.updateOpponent()},getPlayerIDFromContainer:function(e){return $(e).find("a.ismViewProfile").attr("href").replace("#","")},getPlayerPriceFromContainer:function(e){return $(e).find("dd > span").html()},events:{reload:function(){fplAnalyzer.update(true)},prevGW:function(){fplAnalyzer.controls.loader.show();$(".ismPagination a").first().click()},nextGW:function(){fplAnalyzer.controls.loader.show();$(".ismPagination a").last().click()},opponent:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.opponent").css("display","block")},price:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.price").css("display","block")},nti:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.nti").css("display","block")},ntit:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.ntit").css("display","block")},own:function(){$(".ismElementDetail dd > div").css("display","none");$(".ismElementDetail dd > div.ownership").css("display","block")},share:function(){if($(".addthis_sharing_toolbox").css("display")==="none")$(".addthis_sharing_toolbox").show();else $(".addthis_sharing_toolbox").hide()},genRMT:function(){var e="";$.each($(".ismPitchRow"),function(t,n){e+="\n";if(t==4)e+="\nSubs: ";$.each($(n).find("div[id^=ismGraphical]"),function(t,n){e+=$(n).find("span.ismPitchWebName").html().trim()+" "})});window.prompt("You can copy the following RMT string:",e)},predictor:function(){var e=fplAnalyzer.options.selectedPredictor=="CTC"?fplAnalyzer.options.predictors.TFPL:fplAnalyzer.options.predictors.CTC;if(fplAnalyzer.options.selectedPredictor=="CTC"){if(confirm("You are currently using "+fplAnalyzer.options.predictors.CTC+". Change predictor to "+fplAnalyzer.options.predictors.TFPL+"?")){fplAnalyzer.options.selectedPredictor="TFPL";createCookie("fplAnalyzerSelectedPredictor",fplAnalyzer.options.selectedPredictor,30);$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor")}}else if(fplAnalyzer.options.selectedPredictor=="TFPL"){if(confirm("You are currently using "+fplAnalyzer.options.predictors.TFPL+". Change predictor to "+fplAnalyzer.options.predictors.CTC+"?")){fplAnalyzer.options.selectedPredictor="CTC";createCookie("fplAnalyzerSelectedPredictor",fplAnalyzer.options.selectedPredictor,30);$("a.predictor").attr("title",fplAnalyzer.options.selectedPredictor+"- Change Predictor")}}}},updateFixtureNavigateButton:function(){if($(".ismPagPrev").length>0)$("#fplAnalyzerControl .prevGW").html($(".ismPagPrev").html().replace("Gameweek ",""));if($(".ismPagNext").length>0)$("#fplAnalyzerControl .nextGW").html($(".ismPagNext").html().replace("Gameweek ",""))},getNextNOpponent:function(e){var t="";for(i=0;i<fplAnalyzer.options.numberOfOpponentsToDisplay;i++){if(fplAnalyzer.fixArr[e]==undefined||fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]==undefined)continue;t+=fplAnalyzer.fixArr[e][parseInt(fplAnalyzer.currentGW)+i]+(i<fplAnalyzer.options.numberOfOpponentsToDisplay-1?" ":"")}return t}};var fplAnalyzeTrigger=function(){if(location.href.search("fantasy.premierleague.com")<0)return;if(!fplAnalyzer.initialized)fplAnalyzer.init();fplAnalyzer.update()};var createCookie=function(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString()}else var i="";document.cookie=e+"="+t+i+"; path=/"};var readCookie=function(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null};var eraseCookie=function(e){createCookie(e,"",-1)}